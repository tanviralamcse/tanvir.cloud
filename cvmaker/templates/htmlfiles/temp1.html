<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <title>CV Template</title>
  </head>
  <style>
    @media print {
      #download-pdf {
        display: none;
      }
    }
    /* Header layout */
    .cv-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #007bff;
      padding-bottom: 20px;
      margin-bottom: 20px;
    }

    /* Photo styling */
    .cv-header img {
      width: 160px;
      height: 140px;
      object-fit: cover; /* Ensure the image doesn't get distorted */
      border-radius: 8px; /* Optional: rounded corners */
      flex-shrink: 0; /* Prevent shrinking of the image */
    }

    /* Title and contact information */
    .cv-info {
      flex-grow: 1; /* Allow the title/content to grow and take space */
    }

    .cv-info h1 {
      margin: 0;
      font-size: 1.8em;
      color: #007bff;
    }

    .cv-info p {
      margin: 5px 0;
      font-size: 0.9em;
    }
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
      color: #333;
    }

    /* Container to hold the whole CV content */
    .cv-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    /* Section headers */
    .cv-section h2 {
      background: #007bff;
      color: white;
      padding: 10px;
      font-size: 1.2em;
      border-radius: 4px;
      margin-bottom: 15px;
    }

    /* Experience and Education items */
    .cv-item {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
      padding: 10px 15px;
      background: #f1f8ff;
      border-left: 4px solid #007bff;
      border-radius: 5px;
    }

    /* Dates and Responsibilities styling */
    .cv-dates {
      flex: 1;
      font-size: 0.9em;
      color: #555;
    }

    .cv-dates p {
      margin: 0;
    }

    .cv-details {
      flex: 3;
    }

    .cv-details h3 {
      margin: 0 0 5px 0;
      font-size: 1em;
      font-weight: bold;
      color: #333;
    }

    .cv-details p {
      margin: 5px 0;
      font-size: 0.9em;
    }

    .responsibilities ul {
      margin-top: 5px;
      list-style-type: disc;
      padding-left: 20px;
      font-size: 0.9em;
    }

    /* Skills Section */
    .cv-section.skills {
      background: #f1f8ff; /* Same light blue background as other sections */
      border-left: 4px solid #007bff; /* Same blue border */
      border-radius: 5px;
      padding: 15px;
    }

    .skill-container {
      display: flex;
      flex-wrap: wrap; /* Wrap badges to the next line if necessary */
      gap: 10px; /* Space between badges */
      margin-top: 10px;
    }

    .skill-badge {
      background-color: rgb(240, 248, 250); /* Noticeable blue background */
      color: black; /* White text for contrast */
      padding: 5px 10px;
      font-size: 0.9em;
      border-radius: 20px; /* Rounded edges */
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-transform: capitalize; /* Make each skill look neat */
    }

    .cv-section.education .cv-item {
      margin-bottom: 15px;
    }

    /* Fixed buttons styling */
    .fixed-buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fixed-buttons button {
      padding: 10px 15px;
      font-size: 1em;
      font-weight: 500;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease;
    }

    .fixed-buttons button:hover {
      background-color: #0056b3;
    }
  </style>
  <body>
    <div class="cv-container" id="cv-content">
      <header class="cv-header">
        <div class="cv-info">
          <h1>{{ personal_info.first_name }} {{ personal_info.last_name }}</h1>
          <p><strong>Phone:</strong> {{ personal_info.phone }}</p>
          <p><strong>Email:</strong> {{ personal_info.email }}</p>
          <p>
            <strong>Address:</strong> {{ contact_info.address }},
            {{contact_info.city }}, {{ contact_info.zip_code }}
          </p>
        </div>

        <!-- Photo displayed on the right -->
        {% if personal_info.photo_base64 %}
        <img
          src="data:image/jpeg;base64,{{ personal_info.photo_base64 }}"
          alt="Uploaded Photo"
        />
        {% endif %}
      </header>
      <section class="cv-section">
        <h2>About me</h2>
        <p>{{personal_info.about}}</p>
      </section>
      <section class="cv-section">
        <h2>Experience</h2>
        {% for entry in experience %}
        <div class="cv-item">
          <!-- Date and Company Information -->
          <div class="cv-dates">
            <p>
              {{ entry.start_date|default:"Unknown" }} -
              {{entry.end_date|default:"Present" }}
            </p>
            <p>
              <strong align="center"
                >{{ entry.title|default:"No Title Provided" }}</strong
              >
            </p>
            <blockquote>
              <i>{{entry.company}}, {{entry.location}}</i>
            </blockquote>
          </div>

          <!-- Responsibilities -->
          <div class="cv-details">
            {% if entry.responsibilities %}
            <div class="responsibilities">
              <p><b>Responsibilities:</b></p>
              <ul>
                {% for responsibility in entry.responsibilities.splitlines %}
                {%if responsibility.strip %}
                <li>{{ responsibility.strip }}</li>
                {% endif %} {% endfor %}
              </ul>
            </div>
            {% else %}
            <p>No specific responsibilities listed.</p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </section>

      <section class="cv-section">
        <h2>Skills</h2>
        <div class="skill-container">
          {% for skill in skills %}
          <span class="skill-badge">{{ skill }}</span>
          {% endfor %}
        </div>
      </section>

      <section class="cv-section">
        <h2>Education</h2>
        {% for entry in education %}
        <div class="cv-item">
          <p>
            <strong>{{ entry.start_date }} - {{ entry.end_date }}</strong>
          </p>
          <div>
            <p>
              <strong>{{ entry.degree }}</strong>, {{ entry.institution }},
              {{entry.location }}
            </p>
          </div>
        </div>
        {% endfor %}
      </section>
    </div>
    <!-- Fixed Buttons -->
    <div class="fixed-buttons">
      <button id="generate-pdf">Export as PDF</button>
    </div>
    <script>
      document
        .getElementById('generate-pdf')
        .addEventListener('click', function () {
          const element = document.getElementById('cv-content');
          const date = new Date().toISOString().split('T')[0]; // Get the current date in YYYY-MM-DD format

          const options = {
            margin: 0,
            filename: `{{ personal_info.first_name }}_{{ personal_info.last_name }}_${date}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
          };

          html2pdf().from(element).set(options).save();
        });
    </script>
  </body>
</html>
